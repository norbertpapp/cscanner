<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.png">
  
  <title>Writing a Rule - CScanner: A Cloud Security Scanner</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/custom.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Writing a Rule";
    var mkdocs_page_input_path = "development/rule.md";
    var mkdocs_page_url = "/development/rule/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="CScanner: A Cloud Security Scanner" />
<meta property="og:title" content="Writing a Rule"/>
<meta property="og:image" content="https://cscanner.io/img/opengraph.png" />
<meta property="og:url" content="https://cscanner.io/development/rule/" />
<meta property="og:description" content="CScanner scans your cloud accounts for potential security problems." />

<link rel="apple-touch-icon-precomposed" href="https://cscanner.io/img/tileicon.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="CScanner scans your cloud accounts for potential security problems." />
<meta name="twitter:site" content="@janoszen" />
<meta name="twitter:title" content="CScanner" />
<meta name="twitter:image" content="https://cscanner.io/img/opengraph.png" />
<meta name="theme-color" content="#da291c" />
<meta name="msapplication-navbutton-color" content="#da291c" />
<meta name="application-name" content="CScanner" />
<meta name="msapplication-starturl" content="/" />
<meta name="HandheldFriendly" content="true" />
<meta name="msapplication-TileImage" content="https://cscanner.io/img/tileicon.png' | url }}" />

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> CScanner: A Cloud Security Scanner</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../downloads/">Downloads</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud providers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../clouds/aws/">Amazon Web Services</a>
                </li>
                <li class="">
                    
    <a class="" href="../../clouds/exoscale/">Exoscale</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Rules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../rules/firewall/">Firewall</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/s3/">S3</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Contributing to CScanner</a>
                </li>
                <li class="">
                    
    <a class="" href="../provider/">Writing a Provider</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Writing a Rule</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#writing-a-rule">Writing a Rule</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#writing-a-rule-class">Writing a rule class</a></li>
        
            <li><a class="toctree-l4" href="#writing-a-connection-interface">Writing a connection interface</a></li>
        
            <li><a class="toctree-l4" href="#writing-a-rule-builder">Writing a rule builder</a></li>
        
            <li><a class="toctree-l4" href="#writing-a-plugin">Writing a plugin</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">CScanner: A Cloud Security Scanner</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Writing a Rule</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/janoszen/cscanner/edit/master/docs/development/rule.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="writing-a-rule">Writing a Rule</h1>
<div class="admonition warning">
<p class="admonition-title">The API may change!</p>
<p>CScanner is a very young project and the internal API has not yet stabilized. It is recommended that you contact
the author before starting to write a rule or provider to coordinate efforts.</p>
</div>
<p>Writing a rule is a lot less well described than writing a provider as each rule has its very own implementation. For
this example we will stick with an S3 implementation for various cloud providers.</p>
<h2 id="writing-a-rule-class">Writing a rule class</h2>
<p>First of all, we are going to write our actual rule class:</p>
<pre><code class="java">public class MyS3Rule implements Rule&lt;S3Connection&gt; {
    public final static String RULE = &quot;S3_MY_RULE&quot;;
    //This is a parameter that comes from the configuration
    private final boolean scanContents;

    public MyS3Rule(
        boolean scanContents
    ) {
        this.scanContents = scanContents;
    }

    @Override
    public List&lt;RuleResult&gt; evaluate(S3Connection s3Connection) {
        //Evaluate rules here and respond with a list of results. These results contain resources and their compliancy
        //status.        
    }
}
</code></pre>

<h2 id="writing-a-connection-interface">Writing a connection interface</h2>
<p>Now, if you look at this class you can see that it needs an <code>S3Connection</code>. This is an interface that will let you 
retrieve the actual S3 client.</p>
<pre><code class="java">public interface S3Connection extends CloudProviderConnection {
    AmazonS3 getS3Client();
}
</code></pre>

<p>This connection will be injected to the evaluate call for each connection that needs to be checked. Keep in mind though
that some implementations may be more complicated as the cloud resource may be, for example, bound to a region that
you need to handle.</p>
<h2 id="writing-a-rule-builder">Writing a rule builder</h2>
<p>In order for the system to be able to construct the rule with the appropriate parameters, you will also need a 
rule builder like so:</p>
<pre><code class="java">public class MyS3RuleBuilder implements RuleBuilder&lt;S3PublicReadProhibitedRule, S3Connection&gt; {
    @Override
    public String getType() {
        return S3PublicReadProhibitedRule.RULE;
    }

    @Override
    public Class&lt;S3Connection&gt; getConnectionType() {
        return S3Connection.class;
    }

    @Override
    public MyS3Rule create(Map&lt;String, Object&gt; options) {
        //return the configured rule here.
    }
}
</code></pre>

<h2 id="writing-a-plugin">Writing a plugin</h2>
<p>Finally you will need to write a plugin to load the rule. This is quite simple:</p>
<pre><code class="java">public class MyS3Plugin implements Plugin {
    @Override
    public List&lt;RuleBuilder&lt;?, ?&gt;&gt; getSupportedRules() {
        //noinspection unchecked
        return Arrays.asList(
            new MyS3RuleBuilder()
        );
    }
}
</code></pre>

<p>The plugin will need to be added to the CLI module as there is no automatic plugin discovery at this time.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../provider/" class="btn btn-neutral" title="Writing a Provider"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/janoszen/cscanner/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../provider/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
